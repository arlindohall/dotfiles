#!/usr/bin/env ruby

require_relative "lib/version_string"

class RubyFromGemfile
  def self.call
    new.call
  end

  def call
    puts best_version and return if best_version

    puts "No version matching #{read_version}"
  end

  private

  def best_version
    @best_version ||= compute_best_version
  end

  def read_version
    @read_version ||= read_version_from_gemfile
  end

  def compute_best_version
    version_string.valid_versions(available_versions).latest
  end

  def read_version_from_gemfile
    File.read("Gemfile")
      .split("\n")
      .find { |line| line.match(/^ruby/) }
      .split
      .last
      .gsub(/['"]/,'')
  end
end

RubyFromGemfile.call
