#!/usr/bin/env ruby

require 'pathname'

class WorkspaceStatus
  def initialize(path)
    @path = Pathname.new(path)
  end

  def inspect_git_repos
    @path.each_child do |child|
      if child.directory? && child.join('.git').exist?
        print_name child
        dump_git child
      end
    end
  end

  private

    def print_name child
      name = " #{child.basename.to_s} "
      padding = '-' * ((max_length - name.length) / 2)
      header = "#{padding}#{name}#{padding}"
      header = header + '-' if header.length.odd?
      puts "\n#{header}\n\n"
    end

    def max_length
      @max_length ||= calculate_max_length
    end

    def calculate_max_length
      max = @path.each_child.map(&:basename).map(&:to_s).max_by(&:length).length + 12
      max >= 80 ? max : 80
    end

    def dump_git child
      system <<~EOF
      cd #{child}
      git status
      EOF
    end

end


WorkspaceStatus.new('.').inspect_git_repos